<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ExpertRecommendationMapper">

    <!-- 추천 전문가 목록 조회 -->
    <select id="selectRecommendedExperts" resultType="DataBox" parameterType="RequestBox">
        SELECT
            E.expert_seq,
            E.name,
            E.title,
            E.company,
            E.profile_image_url,
            E.linkedin_url,
            E.relevance
        FROM
            fb_ai_expert_recommendations E
                JOIN
            fb_ai_expert_expertise EE ON E.expert_seq = EE.expert_seq
                JOIN
            fb_ai_user_contents UC ON UC.user_content_seq = #{userContentSeq}
                JOIN
            fb_ai_content_tags CT ON EE.expertise = CT.tag
        WHERE
            CT.content_seq = UC.content_seq
          AND E.delete_yn = 'N'
        GROUP BY
            E.expert_seq
        ORDER BY
            E.relevance DESC
            LIMIT 5
    </select>

    <!-- 전문가의 전문 분야 목록 조회 -->
    <select id="selectExpertExpertises" resultType="DataBox" parameterType="RequestBox">
        SELECT
            EE.expertise_seq,
            EE.expertise
        FROM
            fb_ai_expert_expertise EE
        WHERE
            EE.expert_seq = #{expertSeq}
    </select>
</mapper>